

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>datona-comms &mdash; Datona-Lib 0.0.1a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Core Types" href="types.html" />
    <link rel="prev" title="datona-crypto" href="datona-crypto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Datona-Lib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documenation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what.html">What Is Smart Data Access?</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How To Use</a></li>
</ul>
<p class="caption"><span class="caption-text">API Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="datona-blockchain.html">datona-blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="datona-vault.html">datona-vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="datona-crypto.html">datona-crypto</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">datona-comms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#class-smartdataaccessrequest">Class SmartDataAccessRequest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#properties">Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constructor">Constructor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#throws">Throws</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#accept">accept</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reject">reject</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class-datonaconnector">Class DatonaConnector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Constructor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">Throws</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#send">send</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encodetransaction">encodeTransaction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decodetransaction">decodeTransaction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">Throws</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#validateresponse">validateResponse</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">Throws</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#createsuccessresponse">createSuccessResponse</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#createerrorresponse">createErrorResponse</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id32">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id33">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id34">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Core Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#application-layer-protocol">Application Layer Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="datona-errors.html">Errors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Datona-Lib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>datona-comms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/datona-comms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="datona-comms">
<span id="id1"></span><h1>datona-comms<a class="headerlink" href="#datona-comms" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">datona-comms</span></code> component implements the Datona application layer protocol, providing classes and functions to facilitate communication between two datona enabled software applications.</p>
<div class="section" id="class-smartdataaccessrequest">
<span id="smartdataaccessrequest"></span><h2>Class SmartDataAccessRequest<a class="headerlink" href="#class-smartdataaccessrequest" title="Permalink to this headline">¶</a></h2>
<p>Encapsulates a Smart Data Access request from a Requester to an Owner.  This class validates the request and allows the user to accept or reject the request.  If accept or reject is called, this class connects to the Requester’s remote server to send the response.</p>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> <em>(Object)</em> - the transaction data object decoded from the signed transaction given to the constructor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> <em>(Address)</em> - the public blockchain address of the remote server, as decoded from the signed transaction given to the constructor</p></li>
</ul>
</div>
<div class="section" id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h3>
<p>Decodes and validates a raw request transaction from a requester, creating a new SmartDataAccessRequest instance.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">SmartDataAccessRequest</span><span class="p">(</span><span class="nx">signedTxnStr</span><span class="p">,</span> <span class="nx">localPrivateKey</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">signedTxnStr</span></code> <em>(String)</em> - The raw, signed request from the Requester</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">localPrivateKey</span></code> <em>(Key)</em> - The Key object used to sign any transaction responses</p></li>
</ol>
</div>
<div class="section" id="throws">
<h4>Throws<a class="headerlink" href="#throws" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the general transaction structure or signature is invalid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RequestError</span></code> - if the transaction is not a <a class="reference internal" href="types.html#smartdataaccessrequestpacket"><span class="std std-ref">SmartDataAccessRequestPacket</span></a> type or does not have the necessary request data</p></li>
</ul>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SmartDataAccessRequest</span><span class="p">(</span><span class="nx">rawTxn</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="accept">
<h3>accept<a class="headerlink" href="#accept" title="Permalink to this headline">¶</a></h3>
<p>Sends a <a class="reference internal" href="types.html#smartdataaccessresponse"><span class="std std-ref">SmartDataAccessResponse</span></a> to the requester, giving the blockchain address of the SDAC and the URL of the vault that contains the data.  Before responding to the requester it is expected that the contract is already deployed on the blockchain and a vault has already been created with the shared data.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">accept</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">vaultUrl</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id2">
<h4>Parameters<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contractAddress</span></code> <em>(Address)</em> - The blockchain address of the deployed SDAC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultUrl</span></code> <em>(URL)</em> - The URL of the vault holding the data</p></li>
</ol>
</div>
<div class="section" id="returns">
<h4>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - a promise to return the remote server response.</p>
<div class="section" id="resolves-with">
<h5>Resolves With<a class="headerlink" href="#resolves-with" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">Object,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the requester (i.e. the same signatory as the original request).</p>
</div>
<div class="section" id="rejects-with">
<h5>Rejects With<a class="headerlink" href="#rejects-with" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the requester’s server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the requester.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidTransactionError</span></code> - if the server response is not a valid <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h4>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SmartDataAccessRequest</span><span class="p">(</span><span class="nx">rawTxn</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">vaultUrl</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">scheme</span><span class="o">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;datonavault.com&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="o">:</span> <span class="s2">&quot;8643&quot;</span> <span class="p">};</span>

<span class="c1">// Read contract bytecode and ABI from file system and create a Contract object</span>
<span class="kr">const</span> <span class="nx">contractSourceCode</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./contracts/&quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">contract</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">datona</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">contractSourceCode</span><span class="p">.</span><span class="nx">abi</span><span class="p">);</span>

<span class="c1">// Function to create a new vault and store the data.  Returns a Promise.</span>
<span class="kd">function</span> <span class="nx">createAndDeployVault</span><span class="p">(){</span>
  <span class="kr">const</span> <span class="nx">vault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">datona</span><span class="p">.</span><span class="nx">vault</span><span class="p">.</span><span class="nx">RemoteVault</span><span class="p">(</span> <span class="nx">vaultUrl</span><span class="p">,</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">myPrivateKey</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nx">vault</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Function to send the contract address and vault URL to the requester.  Returns a Promise.</span>
<span class="kd">function</span> <span class="nx">informRequester</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">request</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="nx">contract</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">vaultUrl</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">contractSourceCode</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">signatory</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">createAndDeployVault</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">informRequester</span> <span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">)</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="reject">
<h3>reject<a class="headerlink" href="#reject" title="Permalink to this headline">¶</a></h3>
<p>Sends a <a class="reference internal" href="types.html#smartdataaccessresponse"><span class="std std-ref">SmartDataAccessResponse</span></a> to the requester rejecting the request.  This is not strictly necessary since the requester cannot rely on receiving a response.  However, it is polite!</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">reject</span><span class="p">([</span><span class="nx">reason</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="id4">
<h4>Parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reason</span></code> <em>(String)</em> - <em>(Optional)</em> the reason for rejecting the request</p></li>
</ol>
</div>
<div class="section" id="id5">
<h4>Returns<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - a promise to return the remote server response.</p>
<div class="section" id="id6">
<h5>Resolves With<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">Object,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the requester (i.e. the same signatory as the original request).</p>
</div>
<div class="section" id="id7">
<h5>Rejects With<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the requester’s server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the requester.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidTransactionError</span></code> - if the server response is not a valid <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h4>Example<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SmartDataAccessRequest</span><span class="p">(</span><span class="nx">rawTxn</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;you are sharing my data with mail spammers&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</pre></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="class-datonaconnector">
<span id="datonaconnector"></span><h2>Class DatonaConnector<a class="headerlink" href="#class-datonaconnector" title="Permalink to this headline">¶</a></h2>
<p>Enables communications with a remote server abstracting away the underlying network protocols.  Currently, only the <em>file</em> schema (plain tcp connection) is supported.  Other protocols, such as http, will be supported in the future.</p>
<p>Designed to be used as a superclass, this class is extended by the <a class="reference internal" href="#smartdataaccessrequest">SmartDataAccessRequest</a> and <a class="reference internal" href="datona-vault.html#remotevault"><span class="std std-ref">Class RemoteVault</span></a> classes.</p>
<div class="section" id="id9">
<h3>Properties<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> <em>(Address)</em> - the public blockchain address of the remote server, as given to the constructor</p></li>
</ul>
</div>
<div class="section" id="id10">
<h3>Constructor<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Creates a new DatonaConnector instance with a network client suitable for the given url scheme.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">DatonaConnector</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">localPrivateKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id11">
<h4>Parameters<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> <em>(URL)</em> - the URL object identifying the server, port and URI scheme</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">localPrivateKey</span></code> <em>(Key)</em> - The Key object used to sign any transactions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> - the public blockchain address of the remote application.  Used for verifying received responses.</p></li>
</ol>
</div>
<div class="section" id="id12">
<h4>Throws<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RequestError</span></code> - if the url scheme is unsupported</p></li>
</ul>
</div>
<div class="section" id="id13">
<h4>Example<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">scheme</span><span class="o">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;datonavault.com&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="o">:</span> <span class="s2">&quot;8643&quot;</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">remoteAddress</span> <span class="o">=</span> <span class="s2">&quot;0x41A60F71063CD7c9e5247d3E7d551f91f94b5C3b&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">remoteServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatonaConnector</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="send">
<h3>send<a class="headerlink" href="#send" title="Permalink to this headline">¶</a></h3>
<p>Serialises the given object, signs it and returns a promise to send it to the requester.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">send</span><span class="p">(</span><span class="nx">txn</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id14">
<h4>Parameters<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">txn</span></code> <em>(Object)</em> - the transaction to sign and send</p></li>
</ol>
</div>
<div class="section" id="id15">
<h4>Returns<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - a promise to return the remote server response.</p>
<div class="section" id="id16">
<h5>Resolves With<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">Object,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the <code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> given in the constructor.</p>
</div>
<div class="section" id="id17">
<h5>Rejects With<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the requester’s server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the requester.</p></li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h4>Example<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">txn</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">txnType</span><span class="o">:</span> <span class="s2">&quot;VaultRequest&quot;</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="s2">&quot;access&quot;</span><span class="p">,</span> <span class="nx">contract</span><span class="o">:</span> <span class="nx">myContractAddress</span> <span class="p">};</span>

<span class="nx">remoteServer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">txn</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">)</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="encodetransaction">
<h3>encodeTransaction<a class="headerlink" href="#encodetransaction" title="Permalink to this headline">¶</a></h3>
<p>Signs the given transaction object and encodes it ready for transmission.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">encodeTransaction</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id19">
<h4>Parameters<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">txn</span></code> <em>(Object)</em> - The transaction to encode and sign</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> <em>(Key)</em> - The key used to sign the transaction</p></li>
</ol>
</div>
<div class="section" id="id20">
<h4>Returns<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">String</span></code> - a <a class="reference internal" href="types.html#signedtransaction"><span class="std std-ref">SignedTransaction</span></a> object as a JSON formatted string</p>
</div>
<div class="section" id="id21">
<h4>Example<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">datona</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">Key</span><span class="p">(</span><span class="s2">&quot;b94452c533536500e30f2253c96d123133ca1cbdb987556c2dc229573a2cd53c&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">txn</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">txnType</span><span class="o">:</span> <span class="s2">&quot;GeneralResponse&quot;</span><span class="p">,</span> <span class="nx">responseType</span><span class="o">:</span> <span class="s2">&quot;success&quot;</span> <span class="p">};</span>

<span class="kr">const</span> <span class="nx">signedTxnStr</span> <span class="o">=</span> <span class="nx">encodeTransaction</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="decodetransaction">
<h3>decodeTransaction<a class="headerlink" href="#decodetransaction" title="Permalink to this headline">¶</a></h3>
<p>Decodes the given transaction object and returns the data payload.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedTxnStr</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id22">
<h4>Parameters<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">signedTxnStr</span></code> <em>(String)</em> - The JSON formatted <a class="reference internal" href="types.html#signedtransaction"><span class="std std-ref">SignedTransaction</span></a></p></li>
</ol>
</div>
<div class="section" id="id23">
<h4>Returns<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Object</span></code> - object containing the transaction and the signatory’s address</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">txn</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">signatory</span><span class="o">:</span> <span class="nx">Address</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id24">
<h4>Throws<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the transaction data or signature is invalid</p>
</div>
<div class="section" id="id25">
<h4>Example<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">txn</span> <span class="o">=</span> <span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedTxnStr</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;transaction type: &quot;</span><span class="o">+</span><span class="nx">txn</span><span class="p">.</span><span class="nx">txn</span><span class="p">.</span><span class="nx">txnType</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;signatory: &quot;</span><span class="o">+</span><span class="nx">txn</span><span class="p">.</span><span class="nx">signatory</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="validateresponse">
<h3>validateResponse<a class="headerlink" href="#validateresponse" title="Permalink to this headline">¶</a></h3>
<p>Validates the a pre-decoded response transaction against the <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a> format.  If the response is valid and the response type</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">validateResponse</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="p">[</span><span class="nx">expectedTxnType</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="id26">
<h4>Parameters<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">txn</span></code> <em>(Object)</em> - the transaction to validate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expectedTxnType</span></code> <em>(String)</em> - (optional) the expected txnType of the response to override the default of <em>GeneralResponse</em></p></li>
</ol>
</div>
<div class="section" id="id27">
<h4>Throws<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">InvalidTransactionError</span></code> - if the transaction structure is invalid or the txnType does not match the expectedTxnType.</p>
</div>
<div class="section" id="id28">
<h4>Example<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
  <span class="nx">validateResponse</span><span class="p">(</span><span class="nx">myTransaction</span><span class="p">,</span> <span class="s2">&quot;VaultResponse&quot;</span><span class="p">);</span>
  <span class="c1">// no error was thrown so must be a valid VaultResponse</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="createsuccessresponse">
<h3>createSuccessResponse<a class="headerlink" href="#createsuccessresponse" title="Permalink to this headline">¶</a></h3>
<p>Constructs a <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a> Success transaction, optionally of the given type.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">createSuccessResponse</span><span class="p">([</span><span class="nx">txnType</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="id29">
<h4>Parameters<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">txnType</span></code> <em>(String)</em> - (optional) txnType to override default of <em>GeneralResponse</em></p></li>
</ol>
</div>
<div class="section" id="id30">
<h4>Returns<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Object</span></code> - (optional) txnType the <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a> transaction</p>
</div>
<div class="section" id="id31">
<h4>Example<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">createSuccessResponse</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">sdarResponse</span> <span class="o">=</span> <span class="nx">createSuccessResponse</span><span class="p">(</span><span class="s2">&quot;SmartDataAccessResponse&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="createerrorresponse">
<h3>createErrorResponse<a class="headerlink" href="#createerrorresponse" title="Permalink to this headline">¶</a></h3>
<p>Constructs a <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a> Error transaction, optionally of the given type.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">createErrorResponse</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="p">[</span><span class="nx">txnType</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="id32">
<h4>Parameters<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code> <em>(Error)</em> - the error to insert in the transaction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txnType</span></code> <em>(String)</em> - (optional) txnType to override default of <em>GeneralResponse</em></p></li>
</ol>
</div>
<div class="section" id="id33">
<h4>Returns<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Object</span></code> - (optional) txnType the <a class="reference internal" href="types.html#generalserverresponse"><span class="std std-ref">GeneralServerResponse</span></a> transaction</p>
</div>
<div class="section" id="id34">
<h4>Example<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">createErrorResponse</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">signedTxnStr</span> <span class="o">=</span> <span class="nx">encodeTransaction</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="types.html" class="btn btn-neutral float-right" title="Core Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="datona-crypto.html" class="btn btn-neutral float-left" title="datona-crypto" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Datona Labs

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>