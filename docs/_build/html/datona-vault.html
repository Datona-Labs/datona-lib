

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>datona-vault &mdash; Datona-Lib 0.0.1a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="datona-crypto" href="datona-crypto.html" />
    <link rel="prev" title="datona-blockchain" href="datona-blockchain.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Datona-Lib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documenation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what.html">What Is Smart Data Access?</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How To Use</a></li>
</ul>
<p class="caption"><span class="caption-text">API Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="datona-blockchain.html">datona-blockchain</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">datona-vault</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#class-remotevault">Class RemoteVault</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#properties">Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constructor">Constructor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#throws">Throws</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#create">create</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#update">update</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#access">access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#delete">delete</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class-vaultkeeper">Class VaultKeeper</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Constructor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#handlesignedrequest">handleSignedRequest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id21">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#createvault">createVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updatevault">updateVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id31">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id35">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#accessvault">accessVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id36">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id40">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deletevault">deleteVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id41">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id45">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interface-vaultdataserver">Interface VaultDataServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id46">createVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id47">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id48">Returns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id49">updateVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id50">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id51">Returns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id52">accessVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id53">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id54">Returns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id55">deleteVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id56">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id57">Returns</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="datona-crypto.html">datona-crypto</a></li>
<li class="toctree-l1"><a class="reference internal" href="datona-comms.html">datona-comms</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Core Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#application-layer-protocol">Application Layer Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="datona-errors.html">Errors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Datona-Lib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>datona-vault</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/datona-vault.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="datona-vault">
<span id="id1"></span><h1>datona-vault<a class="headerlink" href="#datona-vault" title="Permalink to this headline">¶</a></h1>
<div class="section" id="class-remotevault">
<span id="remotevault"></span><h2>Class RemoteVault<a class="headerlink" href="#class-remotevault" title="Permalink to this headline">¶</a></h2>
<p>Represents a single vault within a vault server controlled by a single S-DAC.  Is designed to be used by data owners to create, update and delete a vault, and by requesters to access a vault.  Extends <a class="reference internal" href="datona-comms.html#datonaconnector"><span class="std std-ref">Class DatonaConnector</span></a>.</p>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> <em>(URL)</em> - the URL given to the constructor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> <em>(Address)</em> - the public blockchain address of the remote data vault server given to the constructor.</p></li>
</ul>
</div>
<div class="section" id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h3>
<p>Creates a new RemoteVault instance with a network client suitable for the given url scheme.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">RemoteVault</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">contractAddress</span><span class="p">,</span> <span class="nx">localPrivateKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> <em>(URL)</em> - the URL object identifying the server, port and URI scheme of the remote data vault server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contractAddress</span></code> <em>(Address)</em> - The address of the contract that controls this vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">localPrivateKey</span></code> <em>(Key)</em> - The Key object used to sign any transactions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> - the public blockchain address of the remote data vault server.  Used for verifying received responses.</p></li>
</ol>
</div>
<div class="section" id="throws">
<h4>Throws<a class="headerlink" href="#throws" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">VaultError</span></code> - if the url scheme is unsupported</p></li>
</ul>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">scheme</span><span class="o">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;datonavault.com&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="o">:</span> <span class="s2">&quot;8643&quot;</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">myContractAddress</span> <span class="o">=</span> <span class="s2">&quot;0x008Cd346b65F5aFa306Ef9160a84455D308e6851&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">remoteAddress</span> <span class="o">=</span> <span class="s2">&quot;0x41A60F71063CD7c9e5247d3E7d551f91f94b5C3b&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">remoteVault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RemoteVault</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">myContractAddress</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="create">
<h3>create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h3>
<p>Promises to create a new vault on the remote data vault server containing the given data.  This method creates the data request, signs it, initiates the vault request and handles the vault response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">create</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id2">
<h4>Parameters<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> <em>(Object)</em> - the data to be stored</p></li>
</ol>
</div>
<div class="section" id="returns">
<h4>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to store the data in this vault and resolve if successful.  Promises to reject if the vault was not created for any reason.</p>
<div class="section" id="resolves-with">
<h5>Resolves With<a class="headerlink" href="#resolves-with" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">VaultResponse,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the <code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> given in the constructor.  See <a class="reference internal" href="types.html#vaultresponse"><span class="std std-ref">VaultResponse</span></a>.  If the response is an error type then the promise will reject instead.</p>
</div>
<div class="section" id="rejects-with">
<h5>Rejects With<a class="headerlink" href="#rejects-with" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ContractOwnerError</span></code> - if you are not the vault owner (the contract owner)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContractExpiryError</span></code> - if the contract has expired</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VaultError</span></code> - if the vault server failed to create the vault for any reason.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the vault server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the vault server’s remote.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MalformedRequestError</span></code> - if the request form is invalid or fields are missing or invalid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidSignatureError</span></code> - if the signatory cannot be recovered from the signature</p></li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h4>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">remoteVault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RemoteVault</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">myContractAddress</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>

<span class="nx">remoteVault</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;vault created successfully&quot;</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="update">
<h3>update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<p>Promises to rewrite the data held in this vault.  This method creates the data request, signs it, initiates the vault request and handles the vault response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id4">
<h4>Parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> <em>(Object)</em> - the data to be stored</p></li>
</ol>
</div>
<div class="section" id="id5">
<h4>Returns<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to update the data in this vault and resolve if successful.  Promises to reject if the vault was not updated for any reason.</p>
<div class="section" id="id6">
<h5>Resolves With<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">VaultResponse,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the <code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> given in the constructor.  See <a class="reference internal" href="types.html#vaultresponse"><span class="std std-ref">VaultResponse</span></a>.  If the response is an error type then the promise will reject instead.</p>
</div>
<div class="section" id="id7">
<h5>Rejects With<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ContractOwnerError</span></code> - if you are not the vault owner (the contract owner)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContractExpiryError</span></code> - if the contract has expired</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VaultError</span></code> - if the vault server failed to update the vault for any reason.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the vault server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the vault server’s remote.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MalformedRequestError</span></code> - if the request form is invalid or fields are missing or invalid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidSignatureError</span></code> - if the signatory cannot be recovered from the signature</p></li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h4>Example<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">remoteVault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RemoteVault</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">myContractAddress</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>

<span class="nx">remoteVault</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&quot;Bye World!&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;vault updated successfully&quot;</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="access">
<h3>access<a class="headerlink" href="#access" title="Permalink to this headline">¶</a></h3>
<p>Promises to retrieve the data from this vault if permitted.  This method creates the data request, signs it, initiates the vault request and handles the vault response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">access</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="id9">
<h4>Returns<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to retrieve the data and resolve if successful.  Promises to reject if the vault could not be accessed for any reason.</p>
<div class="section" id="id10">
<h5>Resolves With<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Object</span></code> - the data returned from the vault exactly as it was originally passed to the <a class="reference internal" href="#create">create</a> or <a class="reference internal" href="#update">update</a> method.</p>
</div>
<div class="section" id="id11">
<h5>Rejects With<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PermissionError</span></code> - if you are not permitted to access the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContractExpiryError</span></code> - if the contract has expired</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VaultError</span></code> - if the vault server could not handle the request for any reason.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the vault server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the vault server’s remote.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MalformedRequestError</span></code> - if the request form is invalid or fields are missing or invalid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidSignatureError</span></code> - if the signatory cannot be recovered from the signature</p></li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h4>Example<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">remoteVault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RemoteVault</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">myContractAddress</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>

<span class="nx">remoteVault</span><span class="p">.</span><span class="nx">access</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;vault contains: &quot;</span><span class="o">+</span><span class="nx">data</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="delete">
<h3>delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>Promises to delete this vault and its data provided the contract has expired or has been terminated.  This method creates the data request, signs it, initiates the vault request and handles the vault response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">delete</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="id13">
<h4>Returns<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to delete the vault and resolve if successful.  Promises to reject if the vault could not be deleted for any reason.</p>
<div class="section" id="id14">
<h5>Resolves With<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">txn:</span> <span class="pre">VaultResponse,</span> <span class="pre">signatory:</span> <span class="pre">Address</span> <span class="pre">}</span></code> - the server response transaction and signatory’s address, validated to confirm it was sent by the <code class="docutils literal notranslate"><span class="pre">remoteAddress</span></code> given in the constructor.  See <a class="reference internal" href="types.html#vaultresponse"><span class="std std-ref">VaultResponse</span></a>.  If the response is an error type then the promise will reject instead.</p>
</div>
<div class="section" id="id15">
<h5>Rejects With<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ContractOwnerError</span></code> - if you are not the vault owner (the contract owner)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContractExpiryError</span></code> - if the contract has not expired</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VaultError</span></code> - if the vault server could not handle the request for any reason.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CommunicationError</span></code> - if communication with the vault server failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionError</span></code> - if the structure of the server response was invalid or was not signed by the vault server’s remote.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MalformedRequestError</span></code> - if the request form is invalid or fields are missing or invalid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InvalidSignatureError</span></code> - if the signatory cannot be recovered from the signature</p></li>
</ul>
</div>
</div>
<div class="section" id="id16">
<h4>Example<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">remoteVault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RemoteServer</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">myContractAddress</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">,</span> <span class="nx">remoteAddress</span><span class="p">);</span>

<span class="nx">remoteVault</span><span class="p">.</span><span class="k">delete</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;vault deleted&quot;</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>
</pre></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="class-vaultkeeper">
<span id="vaultkeeper"></span><h2>Class VaultKeeper<a class="headerlink" href="#class-vaultkeeper" title="Permalink to this headline">¶</a></h2>
<p>Guardian of a Vault Data Server.  Designed to be used by developers of data vault servers, whether cloud based or locally hosted.</p>
<p>All create, update, access and delete requests go through the Vault Keeper, where they are approved or rejected against the Datona Smart Data Access Protocol.  If approved and permission granted by the vault’s Smart Data Access Contract, the VaultKeeper passes the raw request to the <a class="reference internal" href="#vaultdataserver">VaultDataServer</a> object given to the constructor.</p>
<div class="section" id="id17">
<h3>Properties<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultDataServer</span></code> <em>(VaultDataServer)</em> - the <a class="reference internal" href="#vaultdataserver">VaultDataServer</a> instance given to the constructor</p></li>
</ul>
</div>
<div class="section" id="id18">
<h3>Constructor<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Creates a new VaultKeeper instance</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">VaultKeeper</span><span class="p">(</span><span class="nx">vaultDataServer</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id19">
<h4>Parameters<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultDataServer</span></code> <em>(VaultDataServer)</em> - the <a class="reference internal" href="#vaultdataserver">VaultDataServer</a> instance that provides the data server service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> <em>(Key)</em> - The vault server’s private key as a Key object.  Used to sign any transactions.  The signature is used by the remote client to authenticate the vault server and so this key must correspond to the vault server’s public identity.</p></li>
</ol>
</div>
<div class="section" id="id20">
<h4>Example<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">DataServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;MyDataServer.js&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">vaultManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataServer</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">vaultKeeper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VaultKeeper</span><span class="p">(</span><span class="nx">vaultManager</span><span class="p">,</span> <span class="nx">myKey</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="handlesignedrequest">
<h3>handleSignedRequest<a class="headerlink" href="#handlesignedrequest" title="Permalink to this headline">¶</a></h3>
<p>Primary method to process a signed VaultRequest from a client.  Decodes and processes the request, checks the validity of the signature, validates the request and passes the raw data request to the <a class="reference internal" href="#vaultdataserver">VaultDataServer</a> instance given to the constructor.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">handleSignedRequest</span><span class="p">(</span><span class="nx">signedRequestStr</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id21">
<h4>Parameters<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">signedRequestStr</span></code> <em>(SignedTransaction)</em> - the data to be stored</p></li>
</ol>
</div>
<div class="section" id="id22">
<h4>Returns<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to resolve with a signed success or error <a class="reference internal" href="types.html#vaultresponse"><span class="std std-ref">VaultResponse</span></a>.</p>
<div class="section" id="id23">
<h5>Resolves With<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">SignedTransaction</span></code> - containing the VaultResponse and transaction signature, ready to send back to the client.</p>
</div>
<div class="section" id="id24">
<h5>Rejects With<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<p>Does not reject.  Any error is converted to signed error VaultResponse and resolved.</p>
</div>
</div>
<div class="section" id="id25">
<h4>Example<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myDataVaultServer</span> <span class="o">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

<span class="nx">connection</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span>

  <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">vaultKeeper</span><span class="p">.</span><span class="nx">handleSignedRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span> <span class="c1">// should never happen</span>
  <span class="p">});</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="createvault">
<h3>createVault<a class="headerlink" href="#createvault" title="Permalink to this headline">¶</a></h3>
<p>Handles a valid create request.  This method checks the validity of the signature and validates the request before creating a new vault via the VaultDataServer.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">createVault</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id26">
<h4>Parameters<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request</span></code> <em>(VaultRequest)</em> - VaultRequest of type ‘create’ containing the contract address and data to put in the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signatory</span></code> <em>(Address)</em> - signatory the address that signed the request.  Must be the owner of the contract.</p></li>
</ol>
</div>
<div class="section" id="id27">
<h4>Returns<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to create the vault and resolve a success or error response.</p>
<div class="section" id="id28">
<h5>Resolves With<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">SignedTransaction</span></code> - containing the VaultResponse and transaction signature, ready to send back to the client.</p>
</div>
<div class="section" id="id29">
<h5>Rejects With<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h5>
<p>Does not reject.  Any error is converted to signed error VaultResponse and resolved.</p>
<p>An error response will be resolved if:</p>
<ol class="loweralpha simple">
<li><p>the request is not a valid “create” request</p></li>
<li><p>the signature is invalid;</p></li>
<li><p>the signatory is not the owner of the contract</p></li>
<li><p>the contract has expired</p></li>
<li><p>the VaultDataServer returns an error</p></li>
</ol>
</div>
</div>
<div class="section" id="id30">
<h4>Example<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">}</span> <span class="o">=</span> <span class="nx">comms</span><span class="p">.</span><span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedRequestStr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">txn</span><span class="p">.</span><span class="nx">requestType</span> <span class="o">==</span> <span class="s2">&quot;create&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vaultKeeper</span><span class="p">.</span><span class="nx">createVault</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">myServer</span><span class="p">.</span><span class="nx">sendResponse</span> <span class="p">)</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>  <span class="c1">// should never happen</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="updatevault">
<h3>updateVault<a class="headerlink" href="#updatevault" title="Permalink to this headline">¶</a></h3>
<p>Handles a valid update request.  This method checks the validity of the signature and validates the request before updating the vault via the VaultDataServer.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">updateVault</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id31">
<h4>Parameters<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request</span></code> <em>(VaultRequest)</em> - VaultRequest of type ‘update’ containing the contract address and data to put in the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signatory</span></code> <em>(Address)</em> - signatory the address that signed the request.  Must be the owner of the contract.</p></li>
</ol>
</div>
<div class="section" id="id32">
<h4>Returns<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to update the vault and resolve a success or error response.</p>
<div class="section" id="id33">
<h5>Resolves With<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">SignedTransaction</span></code> - containing the VaultResponse and transaction signature, ready to send back to the client.</p>
</div>
<div class="section" id="id34">
<h5>Rejects With<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h5>
<p>Does not reject.  Any error is converted to signed error VaultResponse and resolved.</p>
<p>An error response will be resolved if:</p>
<ol class="loweralpha simple">
<li><p>the request is not a valid “update” request</p></li>
<li><p>the signature is invalid;</p></li>
<li><p>the signatory is not the owner of the contract</p></li>
<li><p>the contract has expired</p></li>
<li><p>the VaultDataServer returns an error</p></li>
</ol>
</div>
</div>
<div class="section" id="id35">
<h4>Example<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">}</span> <span class="o">=</span> <span class="nx">comms</span><span class="p">.</span><span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedRequestStr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">txn</span><span class="p">.</span><span class="nx">requestType</span> <span class="o">==</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vaultKeeper</span><span class="p">.</span><span class="nx">updateVault</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">myServer</span><span class="p">.</span><span class="nx">sendResponse</span> <span class="p">)</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>  <span class="c1">// should never happen</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="accessvault">
<h3>accessVault<a class="headerlink" href="#accessvault" title="Permalink to this headline">¶</a></h3>
<p>Handles a valid access request.  This method checks the validity of the signature and validates the request before accessing the vault via the VaultDataServer.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">accessVault</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id36">
<h4>Parameters<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request</span></code> <em>(VaultRequest)</em> - VaultRequest of type ‘access’ containing the contract address and data to put in the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signatory</span></code> <em>(Address)</em> - signatory the address that signed the request.  Must be permitted to access the vault.</p></li>
</ol>
</div>
<div class="section" id="id37">
<h4>Returns<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to access the vault and resolve a success or error response.</p>
<div class="section" id="id38">
<h5>Resolves With<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">SignedTransaction</span></code> - containing the VaultResponse and transaction signature, ready to send back to the client.  A successful VaultResponse will contain the data from the vault.</p>
</div>
<div class="section" id="id39">
<h5>Rejects With<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h5>
<p>Does not reject.  Any error is converted to a signed error VaultResponse and resolved.</p>
<p>An error response will be resolved if:</p>
<ol class="loweralpha simple">
<li><p>the request is not a valid “access” request</p></li>
<li><p>the signature is invalid;</p></li>
<li><p>the signatory is not permitted to access the vault (contract’s isPermitted function returns false)</p></li>
<li><p>the contract has expired</p></li>
<li><p>the VaultDataServer returns an error</p></li>
</ol>
</div>
</div>
<div class="section" id="id40">
<h4>Example<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">}</span> <span class="o">=</span> <span class="nx">comms</span><span class="p">.</span><span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedRequestStr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">txn</span><span class="p">.</span><span class="nx">requestType</span> <span class="o">==</span> <span class="s2">&quot;access&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vaultKeeper</span><span class="p">.</span><span class="nx">accessVault</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">myServer</span><span class="p">.</span><span class="nx">sendResponse</span> <span class="p">)</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>  <span class="c1">// should never happen</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="deletevault">
<h3>deleteVault<a class="headerlink" href="#deletevault" title="Permalink to this headline">¶</a></h3>
<p>Handles a valid delete request.  This method checks the validity of the signature and validates the request before deleting the vault via the VaultDataServer.  The contract must have expired (contract’s hasExpired function returns true) before a vault can be deleted.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">deleteVault</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id41">
<h4>Parameters<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request</span></code> <em>(VaultRequest)</em> - VaultRequest of type ‘delete’ containing the contract address and data to put in the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signatory</span></code> <em>(Address)</em> - signatory the address that signed the request.  Must be the owner of the contract.</p></li>
</ol>
</div>
<div class="section" id="id42">
<h4>Returns<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to delete the vault and resolve a success or error response.</p>
<div class="section" id="id43">
<h5>Resolves With<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">SignedTransaction</span></code> - containing the VaultResponse and transaction signature, ready to send back to the client.</p>
</div>
<div class="section" id="id44">
<h5>Rejects With<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h5>
<p>Does not reject.  Any error is converted to signed error VaultResponse and resolved.</p>
<p>An error response will be resolved if:</p>
<ol class="loweralpha simple">
<li><p>the request is not a valid “delete” request</p></li>
<li><p>the signature is invalid;</p></li>
<li><p>the signatory is not the owner of the contract</p></li>
<li><p>the contract has not expired</p></li>
<li><p>the VaultDataServer returns an error</p></li>
</ol>
</div>
</div>
<div class="section" id="id45">
<h4>Example<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">}</span> <span class="o">=</span> <span class="nx">comms</span><span class="p">.</span><span class="nx">decodeTransaction</span><span class="p">(</span><span class="nx">signedRequestStr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">txn</span><span class="p">.</span><span class="nx">requestType</span> <span class="o">==</span> <span class="s2">&quot;create&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vaultKeeper</span><span class="p">.</span><span class="nx">createVault</span><span class="p">(</span><span class="nx">txn</span><span class="p">,</span> <span class="nx">signatory</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">myServer</span><span class="p">.</span><span class="nx">sendResponse</span> <span class="p">)</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">);</span>  <span class="c1">// should never happen</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="interface-vaultdataserver">
<span id="vaultdataserver"></span><h2>Interface VaultDataServer<a class="headerlink" href="#interface-vaultdataserver" title="Permalink to this headline">¶</a></h2>
<p>To use the Datona <a class="reference internal" href="#vaultkeeper">VaultKeeper</a>, data vault developers must develop a class of this type that provides the data vault’s data server capability.  For example, a class could be developed to interface with an existing database, a remote file server or a local file system.  If extending this interface, override the functions supported by your data server.</p>
<hr class="docutils" />
<div class="section" id="id46">
<h3>createVault<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>Must promise to create a new vault identified by the given contract address and containing the given data.  Must fail if the vault already exists.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">createVault</span><span class="p">(</span><span class="nx">contract</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id47">
<h4>Parameters<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contract</span></code> <em>(Address)</em> - the address of the contract to identify the vault.  Future update, access and delete requests will identify the vault using this contract address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> <em>(Object)</em> - the data to store in the vault</p></li>
</ol>
</div>
<div class="section" id="id48">
<h4>Returns<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to resolve if successful or reject with an Error object if unsuccessful.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id49">
<h3>updateVault<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h3>
<p>Must promise to unconditionally update the vault identified by the given contract address, overwriting its contents with the given data.  Will fail if the vault does not exist.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">updateVault</span><span class="p">(</span><span class="nx">contract</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id50">
<h4>Parameters<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contract</span></code> <em>(Address)</em> - the address of the contract to identify the vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> <em>(Object)</em> - the data to store in the vault</p></li>
</ol>
</div>
<div class="section" id="id51">
<h4>Returns<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to resolve if successful or reject with an Error object if unsuccessful.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id52">
<h3>accessVault<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<p>Must promise to unconditionally return the data from the vault identified by the given contract address.  Will fail if the vault does not exist.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">accessVault</span><span class="p">(</span><span class="nx">contract</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id53">
<h4>Parameters<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contract</span></code> <em>(Address)</em> - the address of the contract to identify the vault.</p></li>
</ol>
</div>
<div class="section" id="id54">
<h4>Returns<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to resolve the vault contents in the same form given when the vault was created.  Must reject with an Error object if unsuccessful.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id55">
<h3>deleteVault<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<p>Must promise to unconditionally delete the vault identified by the given contract address, overwriting its contents with the given data.  Will fail if the vault does not exist.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">deleteVault</span><span class="p">(</span><span class="nx">contract</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="id56">
<h4>Parameters<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contract</span></code> <em>(Address)</em> - the address of the contract to identify the vault.</p></li>
</ol>
</div>
<div class="section" id="id57">
<h4>Returns<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Promise</span></code> - A promise to resolve if successful or reject with an Error object if unsuccessful.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="datona-crypto.html" class="btn btn-neutral float-right" title="datona-crypto" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="datona-blockchain.html" class="btn btn-neutral float-left" title="datona-blockchain" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Datona Labs

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>